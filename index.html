<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <title>Galeria</title>
    <script>
        let pst, frm;
        window.onload = function(){    //onload garantiza que todos los elementos se hayan cargado para ejecutar el codigo de javascript

            frm = document.getElementById("form-validate");  //Obtenemos el formulario por su id
            pst = new Pristine(frm);  //Instanciamos la clase pristine pasandole el formulario a validar

            frm.addEventListener("submit", function (e) {   //Este formulario cuando se haga un submit ejecutara este codigo
                e.preventDefault();  //Evita que se envie por defecto para validar
                if(pst.validate()){
                    procesarDatos();
                }
                else{
                    frm.classList.add("was-validated");
                }
                //console.log("test"); testeamos que funcione en consola
                //var valid = pst.validate();  el metodo retorna true o false
            });
            frm.addEventListener("reset", function (e) {
                frm.classList.remove("was-validated");
            });

            function procesarDatos(){
                fetch("script.php", {method: "POST",  //fetch hace una peticion al servidor, con formdata usamos los campos del formulario
                body:new FormData(frm)
                }).then(function(response){
                    return response.json();  //retornamos el json obtenido
                }).then(function(json){
                    guardarLocalmente(json);  //pasamos el json generado por el script 
                }).catch(function(err){

                })
            }
            
            function guardarLocalmente(json){
                localStorage.setItem("usuario", JSON.stringify(json));
                location.href = "login.html";
            }
        }
    </script>
</head>
<body>
    <form id="form-validate" novalidate method="POST" class="container">  <!--no vadilate es para que no haga la validacion de html-->
        <div class="form-group">
            <p>Nombre</p>
            <input type="text" class="form-control" name="usuario" required>
        </div>
        <div class="form-group">
            <p>Contrase√±a</p>
            <input type="password" class="form-control" name="password" required>
        </div>
        <div class="form-group">
            <input type="submit" class="btn btn-primary" value="Entrar">
            <input type="reset" class="btn btn-primary" value="Reset">
        </div>
    </form>
    <script src="js/vendor/pristine.min.js"></script>
</body>
</html>